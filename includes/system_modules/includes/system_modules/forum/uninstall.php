<?php
/**
 * Deinstallationsskript für das Forum-Modul
 * 
 * Dieses Skript wird während der Deinstallation des Moduls ausgeführt und
 * entfernt alle vom Modul erstellten Datenbanktabellen, Menüeinträge und Berechtigungen.
 */

// Sicherstellen, dass dieses Skript nur vom ModuleManager aufgerufen wird
if (!defined('MODULE_INSTALL')) {
    define('MODULE_INSTALL', true);
}

// Überprüfen, ob die notwendigen Variablen vorhanden sind
if (!isset($db) || !isset($moduleType) || !isset($logger)) {
    die('Dieses Skript kann nicht direkt aufgerufen werden.');
}

try {
    // Datenbankverbindung abrufen
    $dbConnection = $db->getConnection();
    
    // 1. Menüeinträge entfernen
    $stmt = $dbConnection->prepare("
        DELETE FROM menu_items 
        WHERE url IN ('modules/forum/index.php', 'admin/forum-manager.php')
    ");
    $stmt->execute();
    
    $logger->info("Forum-Menüeinträge entfernt", "module");
    
    // 2. Berechtigungen entfernen
    // Zuerst Berechtigungen aus Gruppen entfernen
    $stmt = $dbConnection->prepare("
        DELETE gp FROM group_permissions gp
        JOIN permissions p ON gp.permission_id = p.permission_id
        WHERE p.name LIKE 'forum_%'
    ");
    $stmt->execute();
    
    // Dann die Berechtigungen selbst entfernen
    $stmt = $dbConnection->prepare("
        DELETE FROM permissions 
        WHERE name LIKE 'forum_%'
    ");
    $stmt->execute();
    
    $logger->info("Forum-Berechtigungen entfernt", "module");
    
    // 3. Datenbanktabellen entfernen
    // Zuerst Fremdschlüsselprüfung deaktivieren
    $dbConnection->exec("SET FOREIGN_KEY_CHECKS = 0");
    
    // Tabellen löschen
    $tables = ['forum_posts', 'forum_topics', 'forum_categories'];
    foreach ($tables as $table) {
        $stmt = $dbConnection->prepare("DROP TABLE IF EXISTS $table");
        $stmt->execute();
    }
    
    // Fremdschlüsselprüfung wieder aktivieren
    $dbConnection->exec("SET FOREIGN_KEY_CHECKS = 1");
    
    $logger->info("Forum-Datenbanktabellen entfernt", "module");
    
    return [
        'success' => true,
        'message' => 'Forum-Modul erfolgreich deinstalliert.'
    ];
    
} catch (Exception $e) {
    $logger->error("Fehler bei der Deinstallation des Forum-Moduls", "module", [
        'error' => $e->getMessage(),
        'trace' => $e->getTraceAsString()
    ]);
    
    return [
        'success' => false,
        'message' => 'Fehler bei der Deinstallation des Forum-Moduls: ' . $e->getMessage()
    ];
}